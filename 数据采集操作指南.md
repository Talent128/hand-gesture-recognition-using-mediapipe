# 数据采集详细操作指南

## 📋 目录
1. [准备工作](#准备工作)
2. [启动采集程序](#启动采集程序)
3. [采集操作步骤](#采集操作步骤)
4. [采集技巧](#采集技巧)
5. [常见问题](#常见问题)

---

## 🔧 准备工作

### 步骤1：处理旧数据

由于旧的"Move"类别包含了混合方向的数据，需要先处理：

```bash
# 运行数据准备工具
python prepare_new_dataset.py

# 选择 4 - 完整流程（推荐）
# 这会：
# 1. 备份旧数据
# 2. 提取 Stop、Clockwise、Counter Clockwise 数据
# 3. 删除混合的 Move 数据
# 4. 准备好新数据集
```

### 步骤2：更新标签文件

编辑 `model/point_history_classifier/point_history_classifier_label.csv`：

**原内容（4行）**:
```csv
Stop
Clockwise
Counter Clockwise
Move
```

**修改为（7行）**:
```csv
Stop
Clockwise
Counter Clockwise
Move Up
Move Down
Move Left
Move Right
```

**Windows 操作**:
```bash
notepad model\point_history_classifier\point_history_classifier_label.csv
```

**Linux/Mac 操作**:
```bash
nano model/point_history_classifier/point_history_classifier_label.csv
```

---

## 🚀 启动采集程序

### 1. 打开命令行/终端

**Windows**: 
- 按 `Win + R`
- 输入 `cmd` 或 `powershell`
- Enter

**Mac**: 
- 按 `Cmd + Space`
- 输入 `Terminal`
- Enter

**Linux**:
- 按 `Ctrl + Alt + T`

### 2. 进入项目目录

```bash
cd "E:\hand gesture\hand-gesture-recognition-using-mediapipe"
```

### 3. 启动程序

```bash
python app.py
```

**程序启动后会显示**:
- 摄像头画面
- FPS 显示
- 实时手势识别结果

---

## 📊 采集操作步骤

### 界面说明

程序运行后，屏幕上会显示：

```
┌─────────────────────────────────────────┐
│  FPS: 30                                │  ← 左上角显示帧率
│                                         │
│              [摄像头画面]               │  ← 中间显示摄像头内容
│                                         │
│  MODE: Logging Point History            │  ← 采集模式时显示
│  NUM: 3                                 │  ← 显示当前选择的类别
│                                         │
└─────────────────────────────────────────┘
```

---

### 操作按键说明

| 按键 | 功能 | 说明 |
|------|------|------|
| `n` | 正常模式 | 只识别，不采集数据 |
| `k` | 静态手势采集模式 | 采集手的形状数据 |
| `h` | **动态轨迹采集模式** | 采集手指移动轨迹数据 ⭐ |
| `0-9` | 选择类别 | 选择要采集的手势类别 |
| `ESC` | 退出程序 | 关闭程序 |

---

### 详细采集流程

#### 阶段1：进入采集模式

```
1. 运行程序: python app.py
2. 按 'h' 键 → 进入轨迹采集模式
3. 屏幕左下角会显示: "MODE: Logging Point History"
```

**验证是否进入采集模式**:
- ✅ 屏幕显示 "MODE: Logging Point History"
- ✅ 可以按 0-9 选择类别

---

#### 阶段2：采集类别 3 - 向上移动 ⬆️

**步骤**:

```
1. 按 '3' 键
   → 屏幕显示: "NUM: 3"

2. 伸出食指做"Pointer"手势（只有食指伸出）
   → 屏幕上会显示手部骨架
   → 手势识别结果显示: "Pointer"

3. 从屏幕下方向上方直线移动
   ⬆️ 起点：屏幕下方 1/3 处
   ⬆️ 终点：屏幕上方 1/3 处
   ⬆️ 轨迹：尽量垂直，不要左右偏移

4. 移动完成后，手离开画面或收回手势

5. 重复步骤 2-4，采集 500-600 次
```

**采集要点**:
```
✓ 速度多样性：
  - 慢速（2-3秒）：采集 150 次
  - 中速（1-1.5秒）：采集 250 次
  - 快速（0.5-1秒）：采集 150 次

✓ 位置多样性：
  - 从屏幕左侧起始：采集 150 次
  - 从屏幕中间起始：采集 250 次
  - 从屏幕右侧起始：采集 150 次

✓ 幅度多样性：
  - 短距离（屏幕高度的 1/4）：100 次
  - 中距离（屏幕高度的 1/3）：300 次
  - 长距离（屏幕高度的 1/2）：100 次
```

**实时反馈**:
- 每次移动完成后，数据会自动保存到 CSV 文件
- 可以随时运行 `python collection_helper.py` 查看进度

---

#### 阶段3：采集类别 4 - 向下移动 ⬇️

**步骤**:

```
1. 按 '4' 键
   → 屏幕显示: "NUM: 4"

2. 伸出食指做"Pointer"手势

3. 从屏幕上方向下方直线移动
   ⬇️ 起点：屏幕上方 1/3 处
   ⬇️ 终点：屏幕下方 1/3 处
   ⬇️ 轨迹：尽量垂直，不要左右偏移

4. 重复采集 500-600 次
```

**注意**:
- 向下移动的速度和幅度要与向上移动保持一致
- 这样可以提高模型对上下方向的识别准确度

---

#### 阶段4：采集类别 5 - 向左移动 ⬅️

**步骤**:

```
1. 按 '5' 键
   → 屏幕显示: "NUM: 5"

2. 伸出食指做"Pointer"手势

3. 从屏幕右侧向左侧直线移动
   ⬅️ 起点：屏幕右侧 1/3 处
   ⬅️ 终点：屏幕左侧 1/3 处
   ⬅️ 轨迹：尽量水平，不要上下偏移

4. 重复采集 500-600 次
```

**采集要点**:
```
✓ 位置多样性（高度）：
  - 从屏幕上方起始：采集 150 次
  - 从屏幕中间起始：采集 250 次
  - 从屏幕下方起始：采集 150 次

✓ 保持水平：
  - 眼睛盯着屏幕边缘作为参考线
  - 移动时尽量不要上下漂移
```

---

#### 阶段5：采集类别 6 - 向右移动 ➡️

**步骤**:

```
1. 按 '6' 键
   → 屏幕显示: "NUM: 6"

2. 伸出食指做"Pointer"手势

3. 从屏幕左侧向右侧直线移动
   ➡️ 起点：屏幕左侧 1/3 处
   ➡️ 终点：屏幕右侧 1/3 处
   ➡️ 轨迹：尽量水平，不要上下偏移

4. 重复采集 500-600 次
```

**注意**:
- 向右移动的速度和幅度要与向左移动保持一致

---

### 查看采集进度

在采集过程中，可以随时打开新的命令行窗口查看进度：

```bash
# 打开新的命令行窗口
# 进入项目目录
cd "E:\hand gesture\hand-gesture-recognition-using-mediapipe"

# 查看采集进度
python collection_helper.py
```

**输出示例**:
```
======================================================================
              🎯 动态手势数据采集进度报告
======================================================================
✅ 类别 0 (Stop               ):  450/ 400  (112.5%)
   [██████████████████████████████]
✅ 类别 1 (Clockwise          ):  520/ 500  (104.0%)
   [██████████████████████████████]
✅ 类别 2 (Counter Clockwise  ):  510/ 500  (102.0%)
   [██████████████████████████████]
🔄 类别 3 (Move Up            ):  280/ 500  ( 56.0%)
   [████████████████░░░░░░░░░░░░░░]
⏳ 类别 4 (Move Down          ):  120/ 500  ( 24.0%)
   [███████░░░░░░░░░░░░░░░░░░░░░░░]
⏳ 类别 5 (Move Left          ):   50/ 500  ( 10.0%)
   [███░░░░░░░░░░░░░░░░░░░░░░░░░░░]
⏳ 类别 6 (Move Right         ):    0/ 500  (  0.0%)
   [░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░]
======================================================================
📊 总体进度: 1930/3400 个样本 (56.8%)
======================================================================

🔄 进度过半！还需采集约 1470 个样本
```

---

## 💡 采集技巧

### 1. 环境设置

**最佳环境**:
```
✓ 光线充足（自然光或白光）
✓ 背景简洁（纯色墙壁最佳）
✓ 摄像头稳定放置
✓ 距离摄像头 30-50cm
✓ 确保手部完全在画面内
```

**避免**:
```
✗ 背光（背后有窗户）
✗ 复杂背景（图案墙纸、杂乱物品）
✗ 光线过暗或过亮
✗ 手超出画面范围
```

---

### 2. 采集节奏

**推荐节奏**:
```
1. 做手势 → 移动 → 收回手势
2. 停顿 1-2 秒
3. 重复

不要连续快速采集，容易疲劳且数据质量下降
```

**分批采集**:
```
建议每次采集 100-150 个样本后休息
- 采集 100 个 → 休息 2-3 分钟
- 查看进度，调整策略
- 继续采集下一批
```

---

### 3. 动作规范

#### 向上/向下移动

```
┌─────────────────┐
│                 │
│      终点 ●     │  ← 向上移动的终点
│        ▲        │
│        │        │  ← 保持垂直
│        │        │
│      起点 ●     │  ← 向上移动的起点
│                 │
└─────────────────┘

✓ DO（正确）:
  - 严格垂直移动
  - 速度均匀
  - 轨迹直线

✗ DON'T（错误）:
  - 斜向移动
  - 忽快忽慢
  - 轨迹弯曲
```

#### 向左/向右移动

```
┌─────────────────┐
│                 │
│  起点●──→●终点  │  ← 向右移动
│                 │  ← 保持水平
│                 │
│  终点●←──●起点  │  ← 向左移动
│                 │
└─────────────────┘

✓ DO（正确）:
  - 严格水平移动
  - 速度均匀
  - 轨迹直线

✗ DON'T（错误）:
  - 上下波动
  - 速度不均
  - 轨迹弯曲
```

---

### 4. 提高数据质量

**多样性策略**:

```
1. 速度多样性
   [慢速]────→  30%
   [中速]───→   50%
   [快速]──→    20%

2. 位置多样性
   向上/下：从左、中、右起始
   向左/右：从上、中、下起始

3. 幅度多样性
   [小幅]─→     20%
   [中幅]──→    60%
   [大幅]────→  20%

4. 角度多样性
   稍微偏离垂直/水平 ±5°
   （不要完全斜向）
```

---

### 5. 实时验证

在采集过程中，可以测试识别效果：

```
1. 按 'n' 键退出采集模式
2. 做手势测试识别
3. 如果识别效果不好，继续采集
4. 按 'h' 键重新进入采集模式
```

---

## ❓ 常见问题

### Q1: 手势没有被识别到

**原因**:
- 手部不在画面内
- "Pointer"手势不标准
- 光线太暗

**解决**:
```bash
# 降低检测阈值
python app.py --min_detection_confidence 0.5
```

**检查手势**:
- 只有食指伸出 ✓
- 其他四指握拳 ✓
- 手掌面向摄像头 ✓

---

### Q2: 数据没有保存

**检查**:
1. 是否按了 'h' 进入采集模式
2. 是否按了 0-9 选择类别
3. 是否做了"Pointer"手势

**验证方法**:
```python
# 查看最新数据
python collection_helper.py
```

或直接查看文件:
```bash
# Windows
notepad model\point_history_classifier\point_history.csv

# Linux/Mac
tail model/point_history_classifier/point_history.csv
```

---

### Q3: 采集速度太慢

**优化方案**:

1. **降低分辨率**:
```bash
python app.py --width 640 --height 480
```

2. **提高采集效率**:
- 保持连续动作
- 减少停顿时间
- 找到合适的节奏

3. **批量采集**:
- 一次采集 50-100 个不休息
- 然后休息 2-3 分钟

---

### Q4: 手势混淆怎么办

**如果向上和向下经常混淆**:
```
1. 增加这两个类别的样本数到 800
2. 强调垂直移动
3. 确保起点和终点差异明显
```

**如果向左和向右经常混淆**:
```
1. 增加这两个类别的样本数到 800
2. 强调水平移动
3. 从不同高度位置采集
```

---

### Q5: 采集累了怎么办

**建议**:

```
采集计划：
- 第一天：采集类别 3 和 4（上下移动）
- 第二天：采集类别 5 和 6（左右移动）

或者：
- 上午：各采集 250 个
- 下午：各采集 250 个
```

**休息很重要**:
- 避免连续采集超过 30 分钟
- 每 100 个样本休息一次
- 手累了要停下来

---

## 📋 采集检查清单

采集完成前，检查以下项目：

```
□ 类别 0 (Stop):           >= 400 个样本
□ 类别 1 (Clockwise):      >= 500 个样本
□ 类别 2 (Counter Clockwise): >= 500 个样本
□ 类别 3 (Move Up):        >= 500 个样本 ⬆️
□ 类别 4 (Move Down):      >= 500 个样本 ⬇️
□ 类别 5 (Move Left):      >= 500 个样本 ⬅️
□ 类别 6 (Move Right):     >= 500 个样本 ➡️

□ 总样本数 >= 3400
□ 数据分布均衡（最少和最多类别的比例 > 0.7）
□ 每个方向都有不同速度的样本
□ 每个方向都有不同位置的样本
```

---

## 🎯 下一步

采集完成后：

```
1. 查看最终统计:
   python collection_helper.py stats

2. 修改训练配置:
   打开 point_history_classification.ipynb
   设置 NUM_CLASSES = 7

3. 开始训练:
   执行 notebook 中的所有单元格

4. 测试新模型:
   python app.py
   测试各个方向的识别效果
```

---

## 💾 数据备份

采集完成后，建议备份数据：

```bash
# 创建备份
python -c "import shutil, datetime; shutil.copy('model/point_history_classifier/point_history.csv', f'model/point_history_classifier/point_history_完整数据_{datetime.datetime.now().strftime(\"%Y%m%d\")}.csv')"
```

---

祝您数据采集顺利！🚀

如有任何问题，随时查阅本文档或提问。

